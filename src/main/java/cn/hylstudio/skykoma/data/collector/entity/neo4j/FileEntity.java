package cn.hylstudio.skykoma.data.collector.entity.neo4j;

import cn.hylstudio.skykoma.data.collector.model.FileDto;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.neo4j.core.schema.*;
import org.springframework.data.neo4j.core.support.UUIDStringGenerator;
import org.springframework.util.CollectionUtils;

import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;


@Node
@Data
public class FileEntity {

    @Id
    @GeneratedValue(generatorClass = UUIDStringGenerator.class)
    private String id;
    @Property
    private String name;
    @Property
    private String type;//file folder
    @Property
    private String relativePath;
    @Property
    private String absolutePath;
    @Relationship(type = "CONTAINS", direction = Relationship.Direction.OUTGOING)
    private List<FileEntity> subFiles;
    @Relationship(type = "HAS_PSI_ELEMENTS", direction = Relationship.Direction.OUTGOING)
    private List<PsiElementEntity> psiElements;
    @CreatedDate
    @Property
    private Long createdAt;

    @LastModifiedDate
    @Property
    private Long updatedAt;

    public FileEntity() {

    }

    public FileEntity(FileDto rootFolder) {
        // -------------- generated by skykoma begin --------------
        this.name = rootFolder.getName();
        this.type = rootFolder.getType();
        this.relativePath = rootFolder.getRelativePath();
        this.absolutePath = rootFolder.getAbsolutePath();
        List<FileDto> subFiles = rootFolder.getSubFiles();
        if (!CollectionUtils.isEmpty(subFiles)) {
            this.subFiles = subFiles.stream().map(FileEntity::new).collect(Collectors.toList());
        } else {
            this.subFiles = Collections.emptyList();
        }
        // -------------- generated by skykoma end --------------

    }

}